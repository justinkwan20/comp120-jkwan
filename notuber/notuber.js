var lat=-99999,lng=-99999;function getLocation(){navigator.geolocation.getCurrentPosition(function(e){lat=e.coords.latitude,lng=e.coords.longitude,init()})}function init(){var e=new google.maps.LatLng(lat,lng);s={zoom:13,center:e,mapTypeId:google.maps.MapTypeId.ROADMAP},i=new google.maps.Map(document.getElementById("map_canvas"),s),r=new google.maps.Marker({position:e,title:"Your Location"});var t=new XMLHttpRequest,o=`username=jLV8vyGV&lat=${lat}&lng=${lng}`;t.open("POST","https://guarded-wave-65478.herokuapp.com/rides",!0),t.setRequestHeader("Content-type","application/x-www-form-urlencoded"),t.onreadystatechange=function(){var o=Number.POSITIVE_INFINITY;if(4==t.readyState&&200==t.status){var a=t.responseText,n=JSON.parse(a);for(let t in n){var l=new google.maps.LatLng(n[t].lat,n[t].lng),s=new google.maps.Marker({position:l,icon:"car.png"});if(google.maps.geometry.spherical.computeDistanceBetween(e,l)<o){o=google.maps.geometry.spherical.computeDistanceBetween(e,l);var g={lat:n[t].lat,lng:n[t].lng}}s.setMap(i)}var p=[{lat:lat,lng:lng},{lat:g.lat,lng:g.lng}];new google.maps.Polyline({path:p,strokeColor:"#FF0000",strokeOpacity:1,strokeWeight:2}).setMap(i)}new google.maps.places.PlacesService(i).nearbySearch({location:e,radius:1609.34,type:"restaurant"},(e,t)=>{if(t===google.maps.places.PlacesServiceStatus.OK&&e)for(let t=0;t<e.length;t++)markerSetter(e[t],i)}),r=new google.maps.Marker({position:e,title:"Your Location"}),r.setMap(i);var c="<h3> Your Location </h3><p> The closest uber is: <b>"+621371e-9*o+"</b> miles away</p>",m=new google.maps.InfoWindow({content:c});google.maps.event.addListener(r,"click",function(){m.setContent(c),m.open(i,r)})},t.send(o)}function markerSetter(e,t){var o=new google.maps.InfoWindow,a=new google.maps.Marker({position:e.geometry.location});google.maps.event.addListener(a,"click",()=>{o.setContent(e.name||""),o.open(t,a)}),a.setMap(t)}
